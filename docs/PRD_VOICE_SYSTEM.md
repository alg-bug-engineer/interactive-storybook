# éŸ³è‰²ç³»ç»Ÿ PRDï¼ˆProduct Requirement Documentï¼‰

## ä¸€ã€äº§å“ç›®æ ‡

ä¸ºäº’åŠ¨æ•…äº‹ä¹¦æä¾›ç»Ÿä¸€ã€å¯æ§çš„å…¨å±€éŸ³è‰²æœ—è¯»ä½“éªŒï¼Œè®©ç”¨æˆ·å¯ä»¥é€‰æ‹©å–œæ¬¢çš„å£°éŸ³ï¼Œå¹¶åœ¨æ‰€æœ‰åœºæ™¯ä¸‹ä¿æŒä¸€è‡´ã€‚

## äºŒã€æ ¸å¿ƒåŠŸèƒ½èŒƒå›´

### æœ¬æœŸåŒ…å«
- âœ… éŸ³è‰²é€‰æ‹©ä¸è¯•å¬
- âœ… å…¨å±€éŸ³è‰²æŒä¹…åŒ–ï¼ˆè·¨ä¼šè¯/è®¾å¤‡ï¼‰
- âœ… TTS å…¨é“¾è·¯éŸ³è‰²é€ä¼ 
- âœ… æ’­æ”¾å™¨å€é€Ÿæ§åˆ¶
- âœ… éŸ³é¢‘è¿›åº¦æ¡ï¼ˆå¯æ‹–æ‹½ã€æ˜¾ç¤ºæ—¶é•¿ï¼‰

### æœ¬æœŸä¸åŒ…å«
- âŒ éŸ³è‰²å…‹éš†ï¼ˆå£°éŸ³ä¸Šä¼ /è®­ç»ƒï¼‰
- âŒ æƒ…ç»ª/éŸ³é«˜ç²¾ç»†è°ƒèŠ‚
- âŒ å¤šè§’è‰²éŸ³è‰²åˆ†é…
- âŒ éŸ³è‰²ç¤¾åŒºåˆ†äº«

## ä¸‰ã€å¯ç”¨éŸ³è‰²åˆ—è¡¨

åŸºäº edge-tts æä¾›çš„ä¸­æ–‡éŸ³è‰²ï¼š

| éŸ³è‰² ID | éŸ³è‰²åç§° | æ€§åˆ« | ç‰¹ç‚¹ | æ¨èåœºæ™¯ |
|---------|---------|------|------|---------|
| `zh-CN-XiaoxiaoNeural` | æ™“æ™“ | å¥³ | æ¸©æŸ”ã€äº²åˆ‡ | ç¡å‰æ•…äº‹ã€å„¿ç«¥æ•…äº‹ï¼ˆ**é»˜è®¤**ï¼‰ |
| `zh-CN-XiaoyiNeural` | æ™“ä¼Š | å¥³ | æ´»æ³¼ã€æ˜å¿« | å†’é™©æ•…äº‹ã€äº’åŠ¨æ•…äº‹ |
| `zh-CN-YunjianNeural` | äº‘å¥ | ç”· | æ²‰ç¨³ã€ç£æ€§ | çºªå½•ç‰‡ã€å†å²æ•…äº‹ |
| `zh-CN-YunxiNeural` | äº‘å¸Œ | ç”· | æ¸©å’Œã€è‡ªç„¶ | é€šç”¨æ•…äº‹ |
| `zh-CN-YunxiaNeural` | äº‘éœ | å¥³ | æŸ”å’Œã€èˆ’ç¼“ | æ”¾æ¾ç±»æ•…äº‹ |
| `zh-CN-YunyangNeural` | äº‘æ‰¬ | ç”· | æ¿€æ˜‚ã€æœ‰åŠ› | åŠ±å¿—æ•…äº‹ã€ä½“è‚²æ•…äº‹ |
| `zh-CN-liaoning-XiaobeiNeural` | å°åŒ—ï¼ˆè¾½å®æ–¹è¨€ï¼‰ | å¥³ | åœ°æ–¹ç‰¹è‰² | ç‰¹è‰²æ•…äº‹ |
| `zh-CN-shaanxi-XiaoniNeural` | å°å¦®ï¼ˆé™•è¥¿æ–¹è¨€ï¼‰ | å¥³ | åœ°æ–¹ç‰¹è‰² | ç‰¹è‰²æ•…äº‹ |

## å››ã€æ ¸å¿ƒè§„åˆ™

### 4.1 å…¨å±€éŸ³è‰²ä¼˜å…ˆçº§
```
ç”¨æˆ·é€‰æ‹©çš„éŸ³è‰² > ç”¨æˆ·é…ç½®çš„éŸ³è‰² > ç³»ç»Ÿé»˜è®¤éŸ³è‰²ï¼ˆæ™“æ™“ï¼‰
```

### 4.2 éŸ³è‰²ç”Ÿæ•ˆèŒƒå›´
- âœ… æ–°å»ºæ•…äº‹çš„ TTS æœ—è¯»
- âœ… ä»ç”»å»ŠåŠ è½½çš„æ•…äº‹ï¼ˆè¦†ç›–åŸéŸ³è‰²ï¼‰
- âœ… äº’åŠ¨åç”Ÿæˆçš„ç»­å†™æ®µè½
- âœ… é‡æ–°æ’­æ”¾ä»»æ„æ®µè½

### 4.3 æŒä¹…åŒ–ç­–ç•¥
- **å‰ç«¯**ï¼šLocalStorage å­˜å‚¨ `selectedVoice`ï¼ˆé¦–å±ç§’å›æ˜¾ï¼‰
- **åç«¯**ï¼šç”¨æˆ·é…ç½®æ–‡ä»¶å­˜å‚¨ `preferred_voice`ï¼ˆè·¨è®¾å¤‡åŒæ­¥ï¼‰
- **åŠ è½½é¡ºåº**ï¼šæœ¬åœ°ç¼“å­˜ â†’ åç«¯ç”¨æˆ·é…ç½® â†’ ç³»ç»Ÿé»˜è®¤å€¼

### 4.4 å¼‚å¸¸å¤„ç†
| å¼‚å¸¸åœºæ™¯ | å¤„ç†ç­–ç•¥ |
|---------|---------|
| é€‰æ‹©çš„éŸ³è‰²ä¸å¯ç”¨ | å›é€€åˆ°é»˜è®¤éŸ³è‰² + Toast æç¤º |
| TTS æœåŠ¡å¤±è´¥ | æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ + æä¾›é‡è¯•æŒ‰é’® |
| éŸ³è‰²è¯•å¬å¤±è´¥ | æ˜¾ç¤º"è¯•å¬å¤±è´¥" + ä¸é˜»æ–­é€‰æ‹©æµç¨‹ |
| ç½‘ç»œæ–­å¼€ | ä½¿ç”¨æœ¬åœ°ç¼“å­˜çš„éŸ³è‰²é…ç½® |

## äº”ã€å…³é”®é¡µé¢ä¸äº¤äº’

### 5.1 éŸ³è‰²é€‰æ‹©é¡µé¢
**å…¥å£**ï¼šè®¾ç½®é¡µé¢/é¦–é¡µæµ®åŠ¨æŒ‰é’®

**å¸ƒå±€**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ™ï¸ é€‰æ‹©æœ—è¯»éŸ³è‰²                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [é»˜è®¤æ¨è]                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚æ™“æ™“ â”‚  â”‚æ™“ä¼Š â”‚  â”‚äº‘å¥ â”‚     â”‚
â”‚  â”‚ â–¶ï¸  â”‚  â”‚ â–¶ï¸  â”‚  â”‚ â–¶ï¸  â”‚     â”‚
â”‚  â”‚ â˜‘ï¸  â”‚  â”‚     â”‚  â”‚     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                  â”‚
â”‚  [æ›´å¤šéŸ³è‰²]                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚äº‘å¸Œ â”‚  â”‚äº‘éœ â”‚  â”‚äº‘æ‰¬ â”‚     â”‚
â”‚  â”‚ â–¶ï¸  â”‚  â”‚ â–¶ï¸  â”‚  â”‚ â–¶ï¸  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**äº¤äº’æµç¨‹**ï¼š
1. ç‚¹å‡»"â–¶ï¸"è¯•å¬ â†’ æ’­æ”¾ç¤ºä¾‹æ–‡æ¡ˆï¼ˆ3-5 ç§’ï¼‰
2. ç‚¹å‡»å¡ç‰‡é€‰æ‹© â†’ é«˜äº®å¹¶æ˜¾ç¤º"å½“å‰ä½¿ç”¨ä¸­"
3. è‡ªåŠ¨ä¿å­˜ â†’ æ— éœ€ç‚¹å‡»"ç¡®å®š"æŒ‰é’®
4. è¿”å›ä¸Šä¸€é¡µ â†’ æ–°éŸ³è‰²ç«‹å³ç”Ÿæ•ˆ

### 5.2 æ’­æ”¾å™¨å¢å¼º
**æ–°å¢æ§ä»¶**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â®ï¸] [â¯ï¸] [â­ï¸]   [ğŸ”Š]  [âš™ï¸]     â”‚
â”‚                                   â”‚
â”‚  â—â”â”â”â”â”â”â”â—‹â”â”â”â”â”â”â”â”â”â”â”â”  1.5x     â”‚
â”‚  01:23 / 05:47                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŠŸèƒ½ç‚¹**ï¼š
- è¿›åº¦æ¡å¯æ‹–æ‹½ï¼ˆç²¾ç¡®åˆ°ç§’ï¼‰
- æ˜¾ç¤ºå½“å‰æ—¶é•¿/æ€»æ—¶é•¿
- å€é€Ÿé€‰æ‹©ï¼š`0.75x / 1x / 1.25x / 1.5x / 2x`
- è®°å¿†ç”¨æˆ·ä¸Šæ¬¡å€é€Ÿåå¥½

## å…­ã€æŠ€æœ¯å®ç°

### 6.1 æ•°æ®æ¨¡å‹

**ç”¨æˆ·é…ç½®æ‰©å±•** (`backend/data/users/{user_id}.json`)ï¼š
```json
{
  "email": "user@example.com",
  "password_hash": "...",
  "is_paid": true,
  "created_at": "1770685912",
  "preferred_voice": "zh-CN-XiaoxiaoNeural",
  "playback_speed": 1.0
}
```

**å‰ç«¯ LocalStorage**ï¼š
```typescript
{
  "selectedVoice": "zh-CN-XiaoxiaoNeural",
  "playbackSpeed": 1.0
}
```

### 6.2 API å˜æ›´

**æ–°å¢æ¥å£**ï¼š
- `GET /api/voices/list` - è·å–æ‰€æœ‰å¯ç”¨éŸ³è‰²
- `GET /api/voices/preview/{voice_id}` - è¯•å¬éŸ³è‰²ï¼ˆè¿”å›éŸ³é¢‘ URLï¼‰
- `POST /api/user/preferences` - ä¿å­˜ç”¨æˆ·éŸ³è‰²åå¥½
- `GET /api/user/preferences` - è·å–ç”¨æˆ·éŸ³è‰²åå¥½

**ä¿®æ”¹æ¥å£**ï¼š
- `POST /api/story/start` - æ–°å¢ `voice` å‚æ•°
- `POST /api/story/{story_id}/next` - æ–°å¢ `voice` å‚æ•°
- `POST /api/story/interact` - æ–°å¢ `voice` å‚æ•°

### 6.3 TTS å®ç°

ä½¿ç”¨ `edge-tts` Python åº“ï¼š
```bash
pip install edge-tts
```

æ ¸å¿ƒä»£ç ï¼š
```python
import edge_tts

async def generate_tts_audio(
    text: str, 
    output_path: str,
    voice: str = "zh-CN-XiaoxiaoNeural",
    rate: str = "+0%"
) -> str:
    communicate = edge_tts.Communicate(text, voice, rate=rate)
    await communicate.save(output_path)
    return output_path
```

## ä¸ƒã€æˆåŠŸæŒ‡æ ‡ï¼ˆKPIï¼‰

### 7.1 æ ¸å¿ƒæŒ‡æ ‡
| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¡¡é‡æ–¹å¼ |
|------|-------|---------|
| é¦–æ¬¡ç”ŸæˆæˆåŠŸç‡ | > 92% | TTS æˆåŠŸæ¬¡æ•° / å°è¯•æ¬¡æ•° |
| é¦–æ¬¡å‡ºå£°æ—¶é—´ï¼ˆTTFAï¼‰ | < 8s | ç‚¹å‡»æ’­æ”¾åˆ°å£°éŸ³å“èµ· |
| éŸ³è‰²è®¾ç½®å®Œæˆç‡ | > 85% | å®Œæˆé€‰æ‹©äººæ•° / è¿›å…¥éŸ³è‰²é¡µäººæ•° |
| æ’­æ”¾å®Œæˆç‡ | > 60% | æ’­æ”¾åˆ° 80% çš„æ¬¡æ•° / æ€»æ’­æ”¾æ¬¡æ•° |

### 7.2 ç•™å­˜æŒ‡æ ‡
| æŒ‡æ ‡ | ç›®æ ‡å€¼ |
|------|-------|
| D1 ç•™å­˜æå‡ | +10% ~ +20% |
| å¹³å‡ä¼šè¯æ—¶é•¿ | +30% |
| åˆ†äº«ç‡ | æå‡ 15% |

## å…«ã€åŸ‹ç‚¹æ¸…å•

```typescript
// éŸ³è‰²ç›¸å…³
trackEvent('voice_preview_played', { voice_id, duration })
trackEvent('voice_selected', { voice_id, source })
trackEvent('voice_switch', { from_voice, to_voice })

// æ’­æ”¾ç›¸å…³
trackEvent('playback_started', { story_id, segment_index, voice_id })
trackEvent('playback_speed_changed', { speed, story_id })
trackEvent('seek_used', { from_time, to_time, story_id })
trackEvent('playback_completed', { story_id, duration })

// TTS ç›¸å…³
trackEvent('tts_requested', { story_id, segment_index, voice_id })
trackEvent('tts_success', { story_id, segment_index, voice_id, latency })
trackEvent('tts_failed', { story_id, segment_index, voice_id, error })
```

## ä¹ã€å¼€å‘è®¡åˆ’

| é˜¶æ®µ | æ—¶é•¿ | äº¤ä»˜ç‰© |
|------|------|--------|
| Phase 0 | 0.5 å¤© | PRD + è®¾è®¡ç¨¿ç¡®è®¤ |
| Phase 1 | 1-1.5 å‘¨ | æ ¸å¿ƒåŠŸèƒ½ä¸Šçº¿ï¼ˆéŸ³è‰²é€‰æ‹© + TTS + æ’­æ”¾å™¨ï¼‰ |
| Phase 2 | 1 å‘¨ | äº¤äº’æ‰“ç£¨ + UI ä¼˜åŒ– |
| Phase 3 | 1 å‘¨ | å¢é•¿åŠŸèƒ½ + æ•°æ®éªŒè¯ |

## åã€é£é™©ä¸åº”å¯¹

| é£é™© | å½±å“ | åº”å¯¹æªæ–½ |
|------|------|---------|
| edge-tts ç¨³å®šæ€§é—®é¢˜ | é«˜ | å‡†å¤‡å¤‡ç”¨ TTS æ–¹æ¡ˆï¼ˆå¦‚ Azure TTSï¼‰ |
| è·¨è®¾å¤‡åŒæ­¥å»¶è¿Ÿ | ä¸­ | æœ¬åœ°ç¼“å­˜ä¼˜å…ˆ + åå°å¼‚æ­¥åŒæ­¥ |
| éŸ³è‰²è¯•å¬åŠ è½½æ…¢ | ä¸­ | é¢„åŠ è½½é»˜è®¤ 3 ä¸ªéŸ³è‰²çš„è¯•å¬éŸ³é¢‘ |
| ç”¨æˆ·ä¸ç†è§£"å…¨å±€éŸ³è‰²" | ä½ | é¦–æ¬¡ä½¿ç”¨å¼•å¯¼åŠ¨ç”» + æ¸…æ™°æ–‡æ¡ˆ |

## åä¸€ã€ä½“éªŒåŸåˆ™ï¼ˆApple/Google å¯å‘ï¼‰

### Apple é£æ ¼
- **å°‘å³æ˜¯å¤š**ï¼šé»˜è®¤æ¨è 3 ä¸ªéŸ³è‰²ï¼Œé«˜çº§é€‰é¡¹æŠ˜å 
- **å³æ—¶åé¦ˆ**ï¼šæ‰€æœ‰æ“ä½œæœ‰åŠ¨ç”»å’ŒçŠ¶æ€æç¤º
- **ä¸€è‡´æ€§**ï¼šæ‰€æœ‰åœºæ™¯ä¸‹éŸ³è‰²ä¿æŒç»Ÿä¸€

### Google é£æ ¼
- **æ™ºèƒ½æ¨è**ï¼šæ ¹æ®æ•…äº‹ç±»å‹æ¨èéŸ³è‰²
- **é€æ˜æ§åˆ¶**ï¼šç”¨æˆ·æ¸…æ¥šçŸ¥é“å½“å‰éŸ³è‰²æ˜¯ä»€ä¹ˆ
- **å¯è®¿é—®æ€§**ï¼šæ”¯æŒé”®ç›˜æ“ä½œã€å±å¹•é˜…è¯»å™¨

---

**ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¥æœŸ**: 2026-02-10  
**è´Ÿè´£äºº**: äº§å“å›¢é˜Ÿ  
**å®¡é˜…**: æŠ€æœ¯å›¢é˜Ÿã€è®¾è®¡å›¢é˜Ÿ
